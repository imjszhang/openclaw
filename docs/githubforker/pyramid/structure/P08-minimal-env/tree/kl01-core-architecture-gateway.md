# KL08: 极简环境部署需严格遵循“预编译依赖 + 定制化 Remaster"策略，通过静态裁剪冗余模块与预先构建核心依赖库，在资源限制与功能需求之间建立精准平衡。

> 所属视角：P08-minimal-env
> 上层论点：核心架构以“本地优先网关”为枢纽，通过五层抽象连接多渠道与多工具，奠定安全路由基石

## 支撑论点

### 8.1: 基于树莓派等低资源硬件的部署，必须依据严格的内存与存储阈值进行静态裁剪，移除非核心通道与重型原生能力以适配物理极限。

- 逻辑顺序：程度（从推荐配置到极限配置的递减约束）
- 引用 atoms: AR-08, AR-09, AR-12, AR-14
- 引用 groups: G15

在资源受限环境（如 Pi Zero 2 W 或 2GB RAM 的 Pi 4）下，必须禁用不推荐的重型通道（如部分实时语音或 Canvas 功能），仅保留核心文本通道以满足最小 500MB 存储和 1GB RAM 的生存底线。这种裁剪直接对应 G15 中提到的架构核心，确保 Gateway 在低配硬件上仍能维持 WebSocket 服务与基本路由功能，避免因资源耗尽导致进程崩溃。

### 8.2: 核心依赖库的预编译与构建产物优化是降低运行时开销的关键，需通过 pnpm 构建流程预先处理 ESM 模块并剔除开发期测试工具。

- 逻辑顺序：时间（构建发布流程的先后顺序）
- 引用 atoms: AR-03, AR-05, AR-07, AR-32
- 引用 groups: G15

遵循 NPM 发布与 Docker 镜像自动触发流程，在构建阶段即完成 TypeScript (ESM) 到高效运行代码的转换，并排除 Vitest 等测试依赖，从而生成针对 linux/arm64 等特定架构的轻量化镜像。这一策略确保了在 VPS 或云端低成本部署时，启动时间最短且运行时内存占用最低，符合“预编译依赖”的核心要求。

### 8.3: 工作区与系统配置的物理隔离及会话上下文的动态压缩机制，是防止磁盘膨胀与内存泄漏、维持长期稳定运行的必要手段。

- 逻辑顺序：结构（存储空间的逻辑分层与数据生命周期管理）
- 引用 atoms: AR-18, AR-19, AR-26, CP-05, CP-06, CP-16
- 引用 groups: G15, G28

通过将用户可编辑的人设记忆（Workspace）与系统状态凭证（~/.openclaw）严格分离，并启用会话自动压缩（Compaction）将旧对话转化为紧凑摘要，可有效控制极简环境下的磁盘与内存增长。结合 G28 中的 Session 隔离机制，这种策略不仅保护了上下文安全，更在有限的存储资源内实现了无限对话周期的可能性。

## 论点间关系

上述论点按照“硬件资源静态约束 → 软件构建时动态优化 → 运行时数据生命周期管理”的程度递进逻辑排列，层层深入地解决了从物理底层到应用顶层的资源平衡问题。

---
