# 序言设计（SCQA）

> 所属视角：P13-extension-system

## 目标读者画像

| 维度     | 描述                                                                                                           |
| -------- | -------------------------------------------------------------------------------------------------------------- |
| 角色     | OpenClaw 核心架构师、插件开发者、安全审计员                                                                    |
| 背景知识 | 熟悉 Node.js 插件机制、OpenClaw 五层抽象架构、基础安全原则                                                     |
| 核心诉求 | 构建一个既灵活可扩展（支持 Channel/Tool/Provider），又在运行时绝对安全（防恶意加载、防路径逃逸）的插件生态体系 |

## S - 情境（Situation）

OpenClaw 系统已确立以“本地优先网关”为核心的五层抽象架构，旨在连接多渠道与多工具。为了适应快速变化的业务需求，系统必须从单体演进为基于“统一注册 API + 分层发现机制 + 生命周期钩子”的插件化生态，以支持标准化的能力扩展。

## C - 冲突（Complication）

然而，动态扩展引入了严峻的安全与稳定性挑战：未经隔离的 SDK 可能导致依赖冲突，缺乏清单驱动的加载易引发路径逃逸，而随意的动态执行（如 curl|bash）更可能绕过配置审批导致系统沦陷。如何在保持“灵活扩展”的同时，建立“分段解析 + 白名单校验 + 动态审批”的纵深防御，成为架构落地的最大矛盾。

## Q - 疑问（Question）

如何设计一套全生命周期的插件规范，既能通过标准化机制实现能力的按需激活与多级覆盖，又能通过严格的运行时沙箱与审批防线确保系统不可被恶意篡改？

## A - 答案（Answer）

构建“清单驱动 + SDK 隔离 + 动态审批”的三重防御体系：通过统一注册与分层发现实现灵活扩展，利用 jiti 动态加载与严格路径检查保障运行时安全，并强制实施分段解析与白名单校验以阻断高风险执行模式。

## 验证

- [x] S 是否是读者已有的共识？（是，基于 G15, G17, G24 对架构和扩展需求的描述）
- [x] C 是否自然地从 S 中产生？（是，G21, G32, G39 明确指出了扩展带来的安全与稳定性痛点）
- [x] Q 是否是 C 的必然追问？（是，解决安全与灵活性矛盾的核心方法论问题）
- [x] A 是否直接回答 Q？（是，提出了具体的三重防御体系作为解决方案）
- [x] A 是否与 synthesis 的顶层观点一致或有意调整？（是，高度整合了 S17, S20, S21, S27 的核心主张）

---

## 修订记录

| 日期       | 变更摘要                                          |
| ---------- | ------------------------------------------------- |
| 2026-02-26 | 首次设计，基于 S17/S20/S21/S27 合成 P13 视角 SCQA |

---
