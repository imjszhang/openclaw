# KL20: 系统架构以“本地优先网关”为核心枢纽，通过五层抽象连接多渠道与多工具，奠定安全路由基石

> 所属视角：P20-skill-discovery
> 上层论点：技能发现系统应从“手动注册”演进为"GitHub Pages 静态注册表 + AI 工具链”的自动化架构，实现 Agent 友好与人类可读的双重服务。

## 支撑论点

### 20.1: 架构采用"Channel-Agent-Workspace-Session"五层抽象模型，将消息接入、身份实例、大脑逻辑与上下文彻底解耦

- 逻辑顺序：结构
- 引用 atoms: CP-01, CP-02, CP-04
- 引用 groups: G28

该模型明确了从渠道账户接收消息到加载 Workspace 执行并维护 Session 上下文的完整流转路径，确保了各层级职责单一且边界清晰。这种解耦设计为技能发现提供了稳定的运行环境，使得技能库可以独立于具体的通信渠道和会话状态进行管理与加载。

### 20.2: “本地优先网关”作为单一控制平面，统一负责 WebSocket 服务、通道管理及请求路由，连接 13+ 多渠道与多类工具

- 逻辑顺序：结构
- 引用 atoms: AR-10, AR-11, AR-12, AR-15
- 引用 groups: G15

网关不仅处理协议验证与事件广播，还作为核心枢纽将 WhatsApp、Telegram 等异构渠道标准化后分发给 Agents 和 Tools。这种集中式路由机制确保了技能调用的一致性，无论底层渠道如何变化，上层的技能发现与执行接口保持统一。

### 20.3: 基于 Workspace 的文件系统层级与严格的会话隔离机制，构建了技能优先级加载与安全执行的基石

- 逻辑顺序：程度
- 引用 atoms: AR-20, CP-05, CP-11, CP-12
- 引用 groups: G15, G28

系统通过 `workspace/skills` 优于全局配置及内置技能的优先级规则，实现了技能的灵活覆盖与个性化扩展；同时，利用 SessionKey 串行锁与文件锁机制，保障了多 Agent 并发执行时的数据一致性与安全性。这为自动化技能注册表提供了可靠的本地存储与执行沙箱，防止了技能冲突与上下文泄露。

## 论点间关系

上述论点遵循“结构解耦 → 核心枢纽连接 → 执行保障”的逻辑递进关系：首先通过五层抽象确立清晰的架构边界，继而由本地优先网关实现物理连接与路由统一，最后依托文件系统层级与隔离机制确保技能加载的优先级秩序与运行安全，共同支撑起自动化的技能发现体系。

---
